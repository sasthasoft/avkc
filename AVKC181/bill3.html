<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shop Rent Payment System</title>

<style>
/* ===== GLOBAL ===== */
body{
  font-family: Arial, sans-serif;
  margin: 0;
  background: #fde4ec;
  padding: 8px;
}

.container{
  max-width: 900px;
  margin: auto;
  background: #ffffff;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(194,24,91,0.35);
}

h3,h4{
  color: #c2185b;
  margin: 10px 0;
}
  
  h2{
  color: blue;
  margin: 10px 0;
}
  
  h2{
  color:Blue;
  margin: 10px 0;
}

label{
  display: block;
  margin-top: 10px;
  font-weight: bold;
  color: #880e4f;
}

/* ===== FORM ELEMENTS ===== */
input,
textarea,
button{
  width: 100%;
  padding: 12px;
  margin: 6px 0;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #c2185b;
  box-sizing: border-box;
}

textarea{
  resize: none;
}

button{
  background: #c2185b;
  color: #ffffff;
  border: none;
  font-weight: bold;
  cursor: pointer;
}

button:hover{
  background: #ad1457;
}

/* ===== MONTH CHECKBOX ===== */
#months label{
  display: inline-block;
  margin-right: 10px;
  font-weight: normal;
  color: #4a0033;
}

/* ===== TOTAL ===== */
#total,
#pending{
  color: #ad1457;
  font-size: 20px;
}

/* ===== TABLE ===== */
.table-wrap{
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  margin-top: 10px;
}

table{
  width: 100%;
  border-collapse: collapse;
  min-width: 850px;
}

th,
td{
  border: 1px solid #c2185b;
  padding: 8px;
  text-align: center;
  font-size: 14px;
}

th{
  background: #c2185b;
  color: #ffffff;
  position: sticky;
  top: 0;
  z-index: 2;
}

td button{
  padding: 6px 10px;
  font-size: 14px;
  margin: 2px;
  border-radius: 6px;
}

/* ===== PRINT RECEIPT ===== */
.bill{
  display: none;
  padding: 20px;
  color: #000000;
}

/* ===== PRINT HEADER ===== */
.print-header{
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 2px solid #000;
  padding: 10px 0;
}

.logo{
  width: 70px;
  height: auto;
}

.print-title{
  flex: 1;
  text-align: center;
  padding: 0 10px;
}

.print-title .line1{
  font-size: 20px;
  font-weight: bold;
}

.print-title .line2{
  font-size: 14px;
  line-height: 1.4;
}

/* ===== PRINT BODY ===== */
.bill-body{
  display: flex;
  margin-top: 20px;
  flex-wrap: wrap;
}

.left-box,
.right-box{
  width: 50%;
  padding: 10px;
  box-sizing: border-box;
}

.left-box{
  border-right: 1px dashed #000;
}

.customer-img{
  width: 120px;
  height: 140px;
  border: 1px solid #000;
  margin-top: 10px;
}

/* ===== PRINT FOOTER ===== */
.bill-footer{
  text-align: right;
  margin-top: 20px;
  font-weight: bold;
}

/* ===== MOBILE ===== */
@media (max-width: 768px){
  .container{
    padding: 10px;
  }

  .left-box,
  .right-box{
    width: 100%;
    border: none;
  }

  h2{
    font-size: 20px;
  }

  table{
    min-width: 750px;
  }
}

/* =========================
   A4 PRINT FORMAT тАУ FINAL
   ========================= */

@media print {

  /* A4 PAGE */
  @page{
    size: A4;
    margin: 15mm;
  }

  body *{
    visibility: hidden;
  }

  .bill, .bill *{
    visibility: visible;
  }

  .bill{
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    font-size: 12.5px;
    color: #000;
  }

  /* ===== TABLE FIX ===== */
  table{
    width: 90%;
    table-layout: fixed;   /* ЁЯФС KEY FIX */
    border-collapse: collapse;
  }

  th, td{
    border: 1px solid #000;
    padding: 6px 4px;
    text-align: center;
    vertical-align: middle;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  th{
    font-weight: bold;
    background: #f3f3f3;
    font-size: 12.5px;
  }

  td{
    font-size: 12.5px;
  }

  /* ===== PAYMENT TABLE COLUMN WIDTHS ===== */
  .bill table th:nth-child(1),
  .bill table td:nth-child(1){width: 8%;}   /* Bill No */

  .bill table th:nth-child(2),
  .bill table td:nth-child(2){width: 12%;}  /* Date */

  .bill table th:nth-child(3),
  .bill table td:nth-child(3){width: 18%;}  /* Month */

  .bill table th:nth-child(4),
  .bill table td:nth-child(4){width: 12%;}  /* Rental */

  .bill table th:nth-child(5),
  .bill table td:nth-child(5){width: 8%;}   /* Tax */

  .bill table th:nth-child(6),
  .bill table td:nth-child(6){width: 12%;}  /* Discount */

  .bill table th:nth-child(7),
  .bill table td:nth-child(7){width: 15%;}  /* Paid */

  .bill table th:nth-child(8),
  .bill table td:nth-child(8){width: 15%;}  /* Pending */

  /* ===== CUSTOMER DETAILS TABLE ===== */
  .bill table.customer-table td{
    text-align: left;
    font-size: 13px;
  }

  /* ===== FOOTER ===== */
  .bill-footer{
    margin-top: 25px;
    text-align: right;
    font-size: 13px;
  }
}
  
/* ===== PRINT RECEIPT ===== */
.bill{display:none;padding:20px}

/* HEADER */
.print-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:2px solid #000;
  padding:10px 0;
}

.logo{
  width:80px;
  height:auto;
}

.print-title{
  flex:1;
  text-align:center;
  padding:0 10px;
}

.print-title .line1{
  font-size:20px;
  font-weight:bold;
}

.print-title .line2{
  font-size:14px;
  margin-top:4px;
  line-height:1.4;
}
/* BODY */
.bill-body{display:flex;margin-top:20px}
.left-box,.right-box{width:50%;padding:10px}
.left-box{border-right:1px dashed #000}
.customer-img{width:120px;height:140px;border:1px solid #000;margin-top:10px}

/* FOOTER */
.bill-footer{text-align:right;margin-top:20px;font-weight:bold}

/* PRINT */
@media print{
  body *{visibility:hidden}
  .bill,.bill *{visibility:visible}
  .bill{position:absolute;top:0;left:0;width:100%}
  @page{size:A4;margin:15mm}
}
</style>
</head>

<body>

<div class="container">
<h2 align="center">Shop Rent Payment</h2>

<input type="number" id="mobile" placeholder="Tenant Mobile">
<button onclick="searchTenant()">Search Tenant</button>

<div id="tenantInfo"></div>

<label>Payment Date</label>
<input type="date" id="payDate">

<div id="months" style="display:none">
<h4>Months Paid</h4>
<script>
["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]
.forEach(m=>document.write(
  `<label><input type="checkbox" value="${m}" onchange="calc()"> ${m}</label>`
));
</script>
</div>

<label>Discount тВ╣</label>
<input type="number" id="discount" value="0" oninput="calc()">

<label>Tax %</label>
<input type="number" id="tax" value="0" oninput="calc()">

<label>Now Paying тВ╣</label>
<input type="number" id="paid" value="0" oninput="calc()">

<label>Remarks</label>
<textarea id="remarks"></textarea>

<h3>Total : тВ╣ <span id="total">0</span></h3>
<h3>Pending : тВ╣ <span id="pending">0</span></h3>

<button onclick="save()">Save & Print</button>

<div class="bill" id="bill"></div>

<h3>All Payments</h3>
<table>
<thead>
<tr>
<th>Date</th><th>Name</th><th>Mobile</th><th>Shop</th>
<th>Months</th><th>Total</th><th>Paid</th><th>Pending</th><th>Actions</th>
</tr>
</thead>
<tbody id="paymentsTableBody"></tbody>
</table>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbzRmLFZkjHlowHGHS9RE3jsHAduVDksjSLttn1BNaWa57bulK-_6WGhmBebOO9YhIX54A/exec";
let tenant={};

window.onload=()=>{
  const d=new Date();
  payDate.value=d.toISOString().split("T")[0];
  loadPayments();
};

/* dd-MMM-yyyy */
function formatDate(v){
  const m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  const p=v.split("-");
  return `${p[2]}-${m[p[1]-1]}-${p[0]}`;
}

function formatDateReverse(v){
  const [dd,m,yyyy]=v.split("-");
  const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  return `${yyyy}-${String(months.indexOf(m)+1).padStart(2,"0")}-${dd}`;
}

function searchTenant(){
  fetch(API,{method:"POST",body:JSON.stringify({action:"searchTenant",mobile:mobile.value})})
  .then(r=>r.json()).then(d=>{
    tenant=d.tenant;
    tenantInfo.innerHTML=`<hr>
<b>Name:</b> ${tenant.tenantName}<br>
<b>Shop:</b> ${tenant.shopNo}<br>
<b>Mobile:</b> ${tenant.mobile}<br>
<b>Rent:</b> тВ╣${tenant.rent}`;
    months.style.display="block";
    calc();
  });
}

function calc(){
  if(!tenant.rent) return;
  const c=document.querySelectorAll("#months input:checked").length;
  const base=c*tenant.rent;
  const disc=+discount.value||0;
  const taxAmt=(base-disc)*(+tax.value||0)/100;
  const totalAmt=base-disc+taxAmt;
  total.innerText=Math.round(totalAmt);
  pending.innerText=Math.round(totalAmt-(+paid.value||0));
}

function save(){
  const monthsPaid=[...document.querySelectorAll("#months input:checked")].map(x=>x.value);
  const base=monthsPaid.length*tenant.rent;
  const disc=+discount.value||0;
  const taxAmt=(base-disc)*(+tax.value||0)/100;
  const totalAmt=base-disc+taxAmt;
  const paidAmt=+paid.value||0;

  const data={
    action:"savePayment",
    paymentDate:formatDate(payDate.value),
    tenantId:tenant.id,
    tenantName:tenant.tenantName,
    mobile:tenant.mobile,
    shopNo:tenant.shopNo,
    months:monthsPaid.join(", "),
    rent:tenant.rent,
    totalAmount:Math.round(totalAmt),
    paidAmount:paidAmt,
    pendingAmount:Math.round(totalAmt-paidAmt),
    remarks:remarks.value
  };

  fetch(API,{method:"POST",body:JSON.stringify(data)})
  .then(r=>r.json()).then(()=>{
    showBill(data);
    loadPayments();
  });
}

function showBill(d){
  bill.innerHTML=`
  <div class="print-header">
    <img src="1.jpg" class="logo">

    <div class="print-title">
      <div class="line1"> <h2>AVKC роЪроЩрпНроХроорпН - роХрпЛро╡ро┐ро▓рпНрокроЯрпНроЯро┐</h2></div>
      <div class="line2">
      <h3>  роЖропро┐ро░ро╡рпИроЪро┐роп роХро╛роЪрпБроХрпНроХро╛ро░ роЪрпЖроЯрпНроЯро┐рокрпНрокро┐ро│рпНройрпИроХро│рпН роЪроЩрпНроХродрпНродро┐ро▒рпНроХрпБ рокро╛родрпНродро┐ропрокрпНрокроЯрпНроЯ роХроЯрпИроХро│рпН ро╡ро╛роЯроХрпИ ро░роЪрпАродрпБ</h3>
      </div>
    </div>

    <img src="2.png" class="logo">
  </div>

  <!-- CUSTOMER DETAILS -->
  <table width="100%" style="margin-top:15px;border-collapse:collapse">
    <tr>
      <td width="30%" rowspan="2" align="center">
        <img src="customer.jpg" class="customer-img">
      </td>
      <td width="70%">
       <h2> <b>рокрпЖропро░рпН :</b> ${d.tenantName} &nbsp;&nbsp;
        <b>роорпКрокрпИро▓рпН :</b> ${d.mobile}</h2>
      </td>
    </tr>
    <tr>
      <td>
       <h3> <b>роХроЯрпИ роОрогрпН :</b> ${d.shopNo} &nbsp;&nbsp;
        <b>рооро╛род ро╡ро╛роЯроХрпИ :</b> тВ╣${tenant.rent}</h3>
      </td>
    </tr>
  </table>

  <!-- PAYMENT DETAILS TABLE -->
  <h3 style="margin-top:20px">Payment Details</h3>

  <h2><table width="100%" border="1" cellspacing="0" cellpadding="6">
<tr>
      <th>Bill No</th>
      <th>Date</th>
      <th>Month of Pay</th>
      <th>Rental</th>
      <th>Tax</th>
      <th>Discount</th>
      <th>Now Paying</th>
      <th>Pending</th>
    </tr>
    <tr align="center">
      <td>AUTO</td>
      <td>${d.paymentDate}</td>
      <td>${d.months}</td>
      <td>тВ╣${tenant.rent}</td>
      <td>${tax.value || 0}%</td>
      <td>тВ╣${discount.value || 0}</td>
      <td>тВ╣${d.paidAmount}</td>
      <td>тВ╣${d.pendingAmount}</td>
    </tr>
  </table></h2>

  <!-- REMARKS -->
  <p style="margin-top:10px">
    <b>Remarks :</b> ${d.remarks || "-"}
  </p>

  <!-- TERMS -->
  <div class="tamil-header">
    <h3>ро╡ро╛роЯроХрпИ роиро┐рокроирпНродройрпИроХро│рпН</h3>
    1.рооро╛род ро╡ро╛роЯроХрпИ рокрпЗроЪро┐ роТрокрпНрокрпБроХрпНроХрпКрогрпНроЯрпБ роорпВройрпНро▒рпБ рооро╛род ро╡ро╛роЯроХрпИ роЕроЯрпНро╡ро╛ройрпНро╕ро╛роХ роЪрпЖро▓рпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН. рооро╛род ро╡ро╛роЯроХрпИропрпИ рооро▒рпБрооро╛родроорпН 5роорпН родрпЗродро┐роХрпНроХрпБро│рпН роЪрпЖро▓рпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН. родро╡ро▒ро┐ройро╛ро▓рпН ро╡роЯрпНроЯро┐ропрпБроЯройрпН роЪрпЗро░рпНродрпНродрпБ ро╡роЪрпВро▓ро┐роХрпНроХрокрпНрокроЯрпБроорпН.<br>
2. роОроХрпНроХро╛ро░рогродрпНродрпИ роорпБройрпНройро┐роЯрпНроЯрпБроорпН роЙро│рпНро╡ро╛роЯроХрпИроХрпНроХрпЛ ро╡рпЗро▒рпБ роирокро░рпБроХрпНроХрпЛ рооро╛ро▒рпНро▒ро┐роХрпН роХрпКро│рпНро│ро╡рпЛ ро╡ро╛роЯроХрпИродро╛ро░ро░рпБроХрпНроХрпБ роЙро░ро┐роорпИ роХро┐роЯрпИропро╛родрпБ. роХроЯрпНроЯро┐роЯроорпН
родрпЗро╡рпИропро┐ро▓рпНро▓рпИропрпЖройрпНро▒ро╛ро▓рпН ро╡ро╛роЯроХрпИ рокро╛роХрпНроХро┐роХро│рпН роЪроХро┐родроорпН роОроЩрпНроХро│рпН ро╡роЪроорпН роТрокрпНрокрпБро╡ро┐роХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН. ро╡ро╛роЯроХрпИродро╛ро░ро░рпНроХро│рпН ро░ро┐рокрпНрокрпЗро░рпН роЪрпЖропрпНродрпБроХрпКро│рпНро│ роЙро░ро┐роорпИ роХро┐роЯрпИропро╛родрпБ.<br>
3. роОро▓роХрпНроЯрпНро░ро┐роХрпН роЪро╛ро░рпНроЬрпНроХро│рпИ рооро╛род-рооро╛родроорпН ро╡ро╛роЯроХрпИродро╛ро░ро░рпНроХро│рпН роЪрпЖро▓рпБродрпНродро┐роХрпН роХрпКро│рпНро│ро╡рпЗрогрпНроЯрпБроорпН.<br>
4. роХроЯрпНроЯро┐роЯроорпН роХро╛ро▓ро┐роЪрпЖропрпНропрпБроорпН рокрпЛродрпБ ро╡ро╛роЯроХрпИрокрпН рокро╛роХрпНроХро┐роХро│рпН рокрпВро░ро╛ро╡рпБроорпН роЪрпЖро▓рпБродрпНродро┐ро╡ро┐роЯрпНроЯрпБ роЕроЯрпНро╡ро╛ройрпНро╕рпН родрпКроХрпИропрпИ ро╡ро╛рокро╕рпН рокрпЖро▒рпНро▒рпБроХрпНроХрпКро│рпНро│ ро╡рпЗрогрпНроЯрпБроорпН. роЖроХрпНроХро┐ро░рооро┐рокрпНрокрпБроХрпНроХрпБ роЗроЯроорпН роХрпКроЯрпБроХрпНроХроХрпН роХрпВроЯро╛родрпБ роЖроХрпНроХро┐ро░рооро┐рокрпНрокрпБ роЪрпЖропрпНропро╡рпБроорпН роХрпВроЯро╛родрпБ.<br>
5. роЗродройрпНрокроЯро┐ роироЯроирпНродрпБ ро╡ро░рпБро╡рпЗройро╛роХро╡рпБроорпН.<br>
6. роЕро░роЪро╛ро▓рпН ро╡ро┐родро┐роХрпНроХрокрпНрокроЯрпБроорпН роЪрпКродрпНродрпБ ро╡ро░ро┐, роироХро░ро╛роЯрпНроЪро┐ ро╡ро░ро┐, роЪрпЗро╡рпИ ро╡ро░ро┐ (GST роЙроЯрпНрокроЯ) роЕро▓рпНро▓родрпБ
роЗродро░ роОроирпНрод ро╡роХрпИропро╛рой ро╡ро░ро┐роХро│рпБроорпН роироЯрпИроорпБро▒рпИропро┐ро▓рпН роЗро░рпБроирпНродро╛ро▓рпН,
роЕродро▒рпНроХро╛рой родрпКроХрпИропрпИ ро╡ро╛роЯроХрпИродро╛ро░ро░рпЗ роЪрпЖро▓рпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН.<br>
7. ро╡ро░ро┐ ро╡ро┐роХро┐родродрпНродро┐ро▓рпН роЕро░роЪрпБ рооро╛ро▒рпНро▒роорпН роЪрпЖропрпНродро╛ро▓рпН роЕро▓рпНро▓родрпБ рокрпБродро┐роп ро╡ро░ро┐ ро╡ро┐родро┐роХрпНроХрокрпНрокроЯрпНроЯро╛ро▓рпН,
роЕродройро╛ро▓рпН роПро▒рпНрокроЯрпБроорпН роХрпВроЯрпБродро▓рпН родрпКроХрпИ роЙроЯройроЯро┐ропро╛роХ ро╡ро╛роЯроХрпИропро┐ро▓рпН роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпНроЯрпБ
ро╡ро╛роЯроХрпИродро╛ро░ро░ро┐роЯрооро┐ро░рпБроирпНродрпБ ро╡роЪрпВро▓ро┐роХрпНроХрокрпНрокроЯрпБроорпН.<br>
8. ро╡ро░ро┐ роЪрпЖро▓рпБродрпНродродрпН родро╡ро▒ро┐ройро╛ро▓рпН роЕро▓рпНро▓родрпБ родро╛роородрооро╛ройро╛ро▓рпН,
роЕродройро╛ро▓рпН роПро▒рпНрокроЯрпБроорпН роЕрокро░ро╛родроорпН, ро╡роЯрпНроЯро┐ роЕро▓рпНро▓родрпБ роЪроЯрпНроЯ роироЯро╡роЯро┐роХрпНроХрпИроХро│рпБроХрпНроХро╛рой
роорпБро┤рпБрокрпН рокрпКро▒рпБрокрпНрокрпБроорпН ро╡ро╛роЯроХрпИродро╛ро░ро░рпИропрпЗ роЪро╛ро░рпБроорпН.<br>
   </div>

  <!-- SIGNATURE -->
  <div class="bill-footer">
   <h3> ро╡роЪрпВро▓ро┐родрпНродро╡ро░рпН роХрпИропрпКрокрпНрокроорпН _____________<br><br>
    ро╡ро╛роЯроХрпИродро╛ро░ро░рпН роХрпИропрпКрокрпНрокроорпН _____________</h3>
  </div>
  `;
  bill.style.display="block";
  window.print();
}

function loadPayments(){
  fetch(API,{method:"POST",body:JSON.stringify({action:"getPayments"})})
  .then(r=>r.json()).then(d=>{
    paymentsTableBody.innerHTML="";
    d.payments.forEach(p=>{
      paymentsTableBody.innerHTML+=`
      <tr>
        <td>${p["Payment Date"]}</td>
        <td>${p["Tenant Name"]}</td>
        <td>${p["Mobile"]}</td>
        <td>${p["Shop No"]}</td>
        <td>${p["Months Paid"]}</td>
        <td>тВ╣${p["Total Amount"]}</td>
        <td>тВ╣${p["Paid Amount"]}</td>
        <td>тВ╣${p["Pending Amount"]}</td>
        <td>
          <button onclick='editPayment(${JSON.stringify(p)})'>Edit</button>
          <button onclick='deletePayment(${p.row})'>Delete</button>
        </td>
      </tr>`;
    });
  });
}

function deletePayment(row){
  if(confirm("Delete this record?")){
    fetch(API,{method:"POST",body:JSON.stringify({action:"deletePayment",row})})
    .then(()=>loadPayments());
  }
}
</script>

</body>
</html>